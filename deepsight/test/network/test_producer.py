# 测试后端back的生产者是否能正常发送消息
# python test-producer.py默认发送测试数据到rabbitmq一次
# python test_producer.py *  发送测试数据到rabbitmq*次

import pika
import time
import sys
import os

# 确保单独执行该脚本时，能够引入其他模块以及django的环境变量
BASE_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.getcwd())))
sys.path.append(BASE_DIR)
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "environconfig.settings.local")
from deepsight.network.coder import encoder

# body = '{"type": "tagging_result", "data": {"code": "HN0102A0119858", "imageUrls": [{"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_32_20.jpg", "rects": [[[935, 2376, 1268, 2666], [2963, 2321, 3380, 2675], [1519, 2126, 1968, 2532], [3348, 441, 3761, 877], [2171, 1390, 2747, 1843], [2123, 2666, 2478, 3025], [1997, 2345, 2455, 2703], [766, 421, 1177, 770], [1433, 2491, 1865, 2842], [1711, 994, 2147, 1365], [31, 726, 380, 998], [0, 2235, 408, 2546], [1859, 219, 2229, 572], [273, 1242, 567, 1601], [3701, 1991, 4045, 2434], [2921, 2053, 3383, 2403], [1647, 292, 1972, 636], [1296, 229, 1703, 658], [23, 2749, 337, 3052], [1154, 1265, 1446, 1577], [1088, 137, 1409, 551], [293, 466, 666, 846], [51, 1466, 333, 1795], [3015, 198, 3450, 575], [620, 667, 1058, 1041], [1217, 393, 1549, 762], [328, 710, 645, 1045], [2273, 231, 2669, 576], [3386, 1848, 3722, 2167], [174, 1915, 517, 2253], [732, 887, 1132, 1184], [880, 1186, 1203, 1576], [75, 1761, 373, 2030], [3506, 2659, 3840, 2979], [3261, 1447, 3685, 1798], [134, 0, 528, 280], [3412, 2195, 3765, 2627], [2142, 398, 2526, 762], [2836, 1875, 3196, 2298], [1019, 1815, 1306, 2119], [226, 2552, 654, 2959], [249, 119, 629, 464], [672, 1104, 1012, 1417], [3666, 1357, 4006, 1708], [2412, 2149, 2769, 2505], [488, 2172, 990, 2553], [2423, 2429, 2745, 2801], [505, 1751, 1044, 2169], [543, 1381, 888, 1703], [1680, 1773, 2033, 2203], [3120, 1658, 3524, 2062], [2718, 396, 3245, 1000], [2838, 2597, 3218, 2899], [3716, 2395, 4021, 2655], [2358, 377, 2763, 762], [0, 1168, 286, 1552], [3492, 985, 3861, 1344], [3310, 2366, 3610, 2734], [90, 370, 421, 677], [498, 362, 845, 728], [1594, 523, 1929, 844], [1884, 2601, 2260, 2975], [2349, 59, 2888, 416]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_33_16.jpg", "rects": [[[867, 329, 1210, 675], [180, 457, 501, 794], [2401, 252, 2868, 664], [1341, 2456, 1694, 2797], [3169, 4, 3855, 595], [2681, 2491, 3012, 2776], [870, 596, 1295, 906], [22, 2220, 391, 2563], [2280, 2305, 2703, 2688], [0, 233, 187, 606], [1947, 2090, 2350, 2430], [844, 1566, 1189, 1956], [3345, 2409, 3735, 2752], [3682, 1244, 4050, 1636], [2597, 1012, 3070, 1415], [2786, 1865, 3167, 2176], [199, 1689, 572, 2102], [999, 996, 1333, 1370], [1299, 586, 1585, 896], [1963, 2444, 2297, 2744], [206, 2443, 503, 2763], [2772, 1487, 3237, 1957], [1974, 360, 2406, 768], [2630, 1336, 3019, 1663], [3723, 1542, 4051, 1881], [1985, 754, 2420, 1146], [1178, 1608, 1516, 2075], [1655, 2349, 1990, 2753], [2904, 2679, 3259, 2994], [1339, 326, 1631, 609], [1034, 2006, 1510, 2435], [70, 1271, 445, 1568], [3600, 2689, 4003, 3055], [1863, 938, 2251, 1365], [2460, 571, 2949, 911], [663, 2484, 1266, 3066], [3629, 1727, 4031, 2208], [33, 1832, 387, 2224], [1634, 204, 2041, 564], [64, 2042, 452, 2357], [3413, 1114, 3761, 1445], [2184, 1698, 2580, 2063], [878, 1238, 1213, 1570], [3701, 2221, 4054, 2593], [15, 554, 379, 861], [3439, 618, 3795, 984], [3724, 816, 4080, 1197], [1521, 1754, 1858, 2163], [271, 2092, 625, 2400], [0, 2539, 338, 2966], [2711, 2693, 3033, 3003], [1180, 148, 1490, 542], [741, 877, 1073, 1231], [1926, 1846, 2263, 2169], [3376, 2183, 3736, 2558], [3016, 2407, 3298, 2711], [3559, 385, 3878, 697], [97, 984, 429, 1301], [3587, 2334, 3916, 2682], [1710, 1695, 2071, 2085], [507, 385, 824, 669], [2088, 1316, 2451, 1665], [2436, 740, 2864, 1143], [1119, 793, 1416, 1121], [1429, 1190, 1748, 1552]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_17_10.jpg", "rects": [[[3618, 2440, 3968, 2784], [3347, 1694, 4090, 2501], [3694, 295, 4067, 767], [941, 352, 1294, 697], [86, 1874, 529, 2185], [1522, 2245, 1917, 2651], [2122, 2094, 2651, 2671], [2178, 13, 3115, 592], [2618, 1444, 3118, 1854], [3585, 809, 3980, 1196], [1983, 1043, 2413, 1400], [1906, 712, 2371, 1081], [3189, 828, 3588, 1206], [1253, 520, 1554, 1017], [8, 249, 300, 705], [867, 832, 1269, 1231], [103, 894, 478, 1272], [2735, 1960, 3159, 2337], [1017, 1155, 1405, 1538], [1387, 1053, 1739, 1388], [8, 1210, 326, 1615], [82, 531, 385, 895], [296, 1083, 688, 1440], [1515, 798, 1798, 1165], [356, 492, 878, 939], [2060, 1379, 2431, 1692], [218, 221, 633, 525], [232, 1446, 561, 1797], [656, 1864, 1166, 2294], [0, 2603, 178, 3066], [3063, 2393, 3578, 3031], [267, 2297, 641, 2621], [306, 2531, 647, 2861], [1485, 2020, 1790, 2384], [1813, 1860, 2164, 2269], [578, 2187, 1006, 2636], [37, 2400, 355, 2737], [1578, 1495, 1916, 1958], [1165, 1281, 1562, 1708], [833, 2195, 1409, 2624], [3281, 467, 3653, 830], [318, 751, 751, 1170], [2, 667, 235, 1088], [3682, 1248, 4090, 1662], [2747, 2429, 3116, 2927], [2544, 1122, 2957, 1500], [1077, 478, 1411, 902], [1386, 202, 1697, 521], [1265, 1502, 1673, 1863], [493, 2620, 894, 2958], [3321, 126, 3861, 458], [8, 1488, 294, 1894], [1059, 1844, 1556, 2433], [1869, 1345, 2187, 1681], [1718, 908, 2074, 1272], [805, 1193, 1209, 1620]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_26_24.jpg", "rects": [[[234, 1748, 855, 2309], [3416, 993, 3887, 1457], [1078, 2059, 1528, 2477], [1809, 1067, 2240, 1490], [1393, 2335, 1751, 2685], [2261, 2434, 2625, 2713], [2844, 451, 3265, 843], [3535, 2252, 3912, 2645], [0, 2319, 353, 2701], [3374, 455, 3712, 949], [3633, 1454, 4048, 1852], [8, 179, 518, 533], [1939, 139, 2391, 577], [2327, 2172, 2714, 2462], [21, 1607, 309, 1979], [1296, 263, 1753, 597], [2895, 2329, 3438, 2709], [1475, 943, 1861, 1313], [0, 2599, 207, 2935], [2240, 483, 2650, 844], [2356, 1742, 2747, 2150], [1782, 2231, 2112, 2631], [781, 849, 1367, 1321], [3673, 2691, 4057, 3034], [0, 996, 419, 1380], [1841, 1459, 2219, 1857], [996, 1811, 1368, 2169], [484, 2346, 874, 2728], [1995, 2345, 2306, 2676], [3701, 57, 4089, 493], [3561, 1819, 4018, 2217], [3507, 1385, 3885, 1717], [2385, 2552, 2739, 2893], [2200, 155, 2628, 520], [1376, 614, 1784, 971], [1702, 1849, 2110, 2290], [2699, 623, 3023, 1040], [0, 1881, 225, 2364], [917, 131, 1343, 526], [2567, 1046, 3019, 1539], [2182, 1743, 2532, 2120], [0, 589, 274, 972], [3772, 392, 4090, 783]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_15_25.jpg", "rects": [[[3594, 2624, 3990, 2877], [2994, 478, 3471, 1165], [2220, 295, 2649, 632], [1665, 1121, 2133, 1568], [42, 261, 436, 603], [1083, 400, 1454, 726], [111, 1343, 477, 1687], [1337, 176, 1789, 553], [3202, 1692, 3642, 2085], [547, 614, 910, 1006], [2338, 2485, 2759, 2894], [220, 2298, 646, 2651], [1252, 2296, 1609, 2652], [3649, 1329, 4090, 1737], [1037, 2586, 1496, 3038], [195, 1929, 695, 2321], [939, 2180, 1311, 2495], [1418, 584, 1750, 951], [0, 532, 266, 929], [3573, 117, 3936, 536], [3684, 2070, 3987, 2471], [654, 1742, 1015, 2076], [156, 1648, 455, 1956], [1888, 2185, 2269, 2563], [3685, 1019, 4000, 1446], [2243, 1530, 2933, 1979], [631, 358, 967, 650], [1847, 0, 2261, 303], [589, 947, 1043, 1591], [2037, 2444, 2402, 2808], [61, 2589, 520, 2945], [454, 1482, 786, 1841], [2725, 2064, 3153, 2418], [229, 1078, 566, 1388], [3846, 709, 4090, 1198], [13, 909, 347, 1236], [1051, 648, 1385, 952], [222, 638, 535, 972], [2776, 2432, 3232, 2823], [688, 1493, 1074, 1808], [3710, 1596, 4062, 1963], [2254, 1872, 2774, 2349], [905, 326, 1303, 627], [418, 1846, 776, 2191], [1761, 1489, 2161, 1852], [3088, 2019, 3530, 2369], [528, 1972, 876, 2347], [859, 484, 1187, 777], [3162, 2326, 3519, 2693], [1994, 230, 2392, 548], [2345, 103, 2685, 390]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_12_21.jpg", "rects": [[[99, 416, 458, 753], [519, 37, 935, 420], [648, 1048, 1095, 1392], [1707, 301, 2129, 667], [1096, 77, 1401, 470], [3314, 254, 3792, 602], [3622, 565, 3972, 914], [1115, 1825, 1592, 2297], [3559, 1528, 4009, 1931], [679, 1345, 1120, 1708], [2116, 489, 2600, 1051], [500, 398, 874, 769], [3637, 1194, 3996, 1490], [1578, 24, 1966, 323], [3247, 1678, 3869, 2731], [248, 165, 585, 532], [2614, 356, 2957, 651], [3062, 458, 3387, 802], [1694, 2458, 2038, 2795], [941, 2239, 1283, 2569], [479, 2405, 1087, 2831], [1292, 2227, 1676, 2572], [2934, 743, 3367, 1236], [612, 1992, 1016, 2610], [2559, 832, 2947, 1277], [2342, 180, 2684, 574], [767, 823, 1111, 1130], [3392, 0, 3874, 318], [3758, 191, 4090, 572], [1158, 2405, 1517, 2824], [0, 645, 255, 1037], [20, 2143, 487, 2639], [3325, 490, 3661, 805], [3740, 939, 4077, 1325], [0, 1651, 403, 2251], [1039, 535, 1341, 867], [1330, 272, 1608, 554], [514, 724, 867, 1068], [953, 370, 1225, 738], [2621, 32, 2900, 471], [2604, 562, 2928, 880], [2, 138, 285, 522], [2752, 1322, 3205, 1686], [2366, 1110, 2773, 1500], [2168, 2135, 2900, 2794]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_20_22.jpg", "rects": [[[3190, 186, 3562, 534], [2958, 1248, 3368, 1656], [2336, 1338, 2871, 1773], [1724, 1188, 2181, 1476], [480, 1635, 961, 1982], [96, 983, 477, 1306], [1168, 1679, 1820, 2362], [1693, 1446, 2070, 1852], [3699, 2152, 4057, 2454], [160, 2488, 512, 2896], [922, 2418, 1520, 2889], [2858, 529, 3212, 866], [2, 2276, 255, 2661], [2741, 2329, 3169, 2750], [3414, 499, 3913, 820], [1638, 2385, 2049, 2772], [1058, 158, 1419, 589], [900, 719, 1278, 1094], [121, 176, 599, 564], [3605, 1105, 3996, 1499], [3, 440, 234, 883], [1726, 406, 2118, 757], [3789, 1461, 4060, 1792], [2242, 104, 2530, 568], [66, 1900, 437, 2313], [2610, 329, 2957, 603], [3456, 808, 3761, 1126], [0, 797, 237, 1138], [2733, 55, 3092, 438], [1667, 156, 2059, 495], [3828, 2717, 4090, 3035], [484, 2379, 822, 2697], [772, 300, 1053, 848], [3101, 559, 3482, 948], [1940, 2003, 2456, 2406], [3485, 1895, 3783, 2274], [619, 1111, 938, 1531], [587, 2225, 919, 2550], [2790, 848, 3193, 1241], [1930, 0, 2287, 346], [82, 1410, 460, 1771], [47, 1655, 443, 2059], [232, 435, 605, 722], [1288, 2389, 1624, 2782], [384, 2181, 717, 2504], [532, 515, 848, 874], [3278, 2551, 3697, 2956], [2657, 1042, 2999, 1380], [165, 2157, 502, 2465], [3701, 647, 4055, 951], [2121, 2489, 2510, 2815]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_27_17.jpg", "rects": [[[2661, 1738, 3088, 2125], [2632, 1343, 3047, 1775], [3757, 2583, 4047, 2876], [1821, 840, 2259, 1239], [3676, 1748, 4037, 2121], [129, 52, 664, 452], [2103, 1417, 2552, 1796], [2278, 134, 2569, 448], [3537, 0, 3904, 580], [106, 1148, 522, 1486], [1857, 1236, 2187, 1666], [1369, 2469, 1753, 2804], [513, 2263, 937, 2694], [2483, 162, 2821, 506], [2453, 516, 2842, 833], [3617, 1390, 4009, 1773], [2707, 296, 3141, 655], [3123, 2370, 3532, 2739], [898, 2423, 1226, 3004], [2801, 601, 3101, 1019], [3014, 1273, 3458, 1653], [1227, 823, 1622, 1229], [13, 2086, 403, 2951], [1582, 1393, 1936, 1808], [0, 477, 313, 823], [3136, 238, 3518, 552], [1052, 330, 1583, 738], [127, 1580, 603, 1941], [1965, 2410, 2390, 2844], [1116, 572, 1483, 880], [143, 769, 511, 1111], [2786, 1108, 3132, 1411], [2985, 1573, 3356, 1874], [904, 1628, 1343, 1949], [2653, 2080, 3102, 2342], [930, 1957, 1400, 2284], [2833, 2339, 3186, 2607], [612, 1157, 1057, 1527], [3106, 2043, 3480, 2394], [405, 514, 755, 849], [3216, 1698, 3632, 2073], [560, 1901, 859, 2248], [1735, 2403, 2081, 2741], [1321, 1336, 1730, 1744], [140, 1876, 561, 2199], [11, 1712, 381, 2110], [3604, 796, 4021, 1167]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_11_14.jpg", "rects": [[[13, 1245, 346, 1589], [655, 1625, 1058, 2041], [2860, 685, 3203, 1078], [1043, 551, 1503, 954], [1907, 858, 2296, 1262], [172, 1762, 513, 2085], [827, 2438, 1161, 2803], [1211, 1969, 1624, 2364], [787, 280, 1156, 660], [3209, 2510, 4036, 3057], [3577, 389, 3992, 753], [3587, 2104, 3988, 2505], [1714, 1498, 2214, 1874], [2480, 609, 2860, 1013], [819, 2627, 1183, 3066], [2528, 265, 2940, 670], [1149, 1553, 1572, 1927], [2741, 2536, 3087, 3037], [2520, 1923, 3124, 2385], [3639, 1751, 4019, 2094], [3591, 1308, 3947, 1660], [1674, 1224, 2080, 1675], [436, 2070, 812, 2389], [1511, 2236, 1807, 2643], [3597, 803, 4044, 1227], [305, 1948, 669, 2228], [2838, 1492, 3285, 1771], [839, 1376, 1277, 1633], [4, 2401, 273, 3066], [2592, 2313, 2977, 2619], [3000, 1015, 3407, 1296], [1924, 2781, 2495, 3066], [713, 1036, 1123, 1349], [2180, 440, 2594, 737], [1642, 372, 1971, 712], [25, 1582, 364, 1854], [57, 793, 407, 1128], [0, 311, 167, 592], [2012, 2501, 2457, 2891], [3250, 417, 3647, 731], [1506, 287, 1836, 627], [2893, 1125, 3363, 1560], [3630, 1122, 4023, 1449], [3556, 1577, 3949, 1938], [95, 581, 345, 818], [3132, 518, 3498, 832], [981, 1592, 1333, 1986], [216, 2339, 492, 2678], [2480, 919, 2844, 1291], [2638, 502, 2989, 904]]]}, {"imageUrl": "http://192.168.1.47:12277/group1/HN0102A0119858/Z_21_19.jpg", "rects": [[[1949, 333, 2461, 948], [7, 2473, 310, 2908], [2370, 758, 2750, 1190], [1, 857, 389, 1459], [1015, 863, 1371, 1197], [1251, 420, 1628, 769], [1054, 1786, 1436, 2117], [82, 475, 484, 953], [2901, 740, 3305, 1122], [298, 0, 695, 425], [3442, 966, 3815, 1461], [3304, 2361, 3715, 2684], [384, 2128, 1037, 2636], [998, 2173, 1396, 2669], [822, 1238, 1189, 1781], [886, 364, 1257, 701], [2837, 518, 3192, 883], [3086, 1086, 3458, 1495], [1510, 79, 1823, 457], [1059, 2484, 1522, 2906], [2125, 2300, 2639, 2744], [1675, 2742, 2034, 3047], [3704, 1374, 4018, 1674], [2027, 1138, 2314, 1669], [3785, 924, 4090, 1368], [3695, 2465, 4090, 3066], [3297, 2529, 3662, 2923], [630, 1875, 1120, 2202], [0, 141, 275, 513], [2413, 1097, 2751, 1417], [3056, 2549, 3441, 2916], [1898, 2557, 2199, 2880], [2974, 181, 3498, 511], [954, 1490, 1290, 1843], [2205, 1452, 2569, 1876], [3121, 600, 3558, 958]]]}]}}'

body = '{"type":"tagging_request","data":{"code":"HN00001","imageUrls":["http://xxxx/1.jpg","http://xxxx/10.jpg","http://xxxx/111. jpg ","http://xxxx/130. jpg ","http://xxxx/190. jpg ","http://xxxx/30.jpg","http://xxxx/50. jpg ","http://xxxx/60. jpg ","http://xxxx/80. jpg","http://xxxx/90. jpg "]}}'

# body = "vito"

# 定义循环发送多少条数据
if len(sys.argv) == 1:
    encoder.encoder(body)
    print("已发送1次")
else:
    try:
        for i in range(int(sys.argv[1])):
            encoder.encoder(body)
        print("已发送{}次".format(int(sys.argv[1])))
    except ValueError:
        print("参数需要为正整数")

